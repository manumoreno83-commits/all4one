<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#0B1120" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="All4One" />
    <link rel="manifest" href="./manifest.json" />
    <link rel="apple-touch-icon" href="./assets/logo.png" />
    <title>All4one - Entrenador Miguel</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
</head>

<body>
    <div id="auth-overlay" class="view active"
        style="padding:0; background:var(--bg-primary); display:flex; align-items:center; justify-content:center; position:fixed; top:0; left:0; width:100%; height:100%; z-index:2000;">
        <div class="login-card"
            style="text-align:center; padding:40px; background:var(--bg-secondary); border-radius:24px; border:1px solid var(--bg-tertiary); max-width:340px; width:90%;">
            <img src="./assets/logo.png" alt="Logo" style="height:60px; margin-bottom:20px;">
            <h2 style="margin-bottom:8px;">Bienvenido</h2>
            <p style="margin-bottom:30px; font-size:14px;">Entra para gestionar tus entrenamientos o tu club</p>

            <div id="trainer-login-area" style="margin-bottom:12px;">
                <button id="initial-admin-btn" class="btn-primary" onclick="toggleTrainerSelect()"
                    style="width:100%; display:flex; align-items:center; justify-content:center; gap:10px;">
                    Entrar como Coach
                </button>
            </div>

            <div
                style="margin:20px 0; display:flex; align-items:center; gap:10px; color:var(--text-secondary); font-size:12px;">
                <div style="flex:1; height:1px; background:var(--bg-tertiary);"></div>
                O ACCESO ALUMNO
                <div style="flex:1; height:1px; background:var(--bg-tertiary);"></div>
            </div>

            <button class="btn-ghost" onclick="loginSimulation('student')"
                style="width:100%; display:flex; align-items:center; justify-content:center; gap:10px; background:white; color:black; border:none;">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="#4285F4"
                        d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                    <path fill="#34A853"
                        d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                    <path fill="#FBBC05"
                        d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" />
                    <path fill="#EA4335"
                        d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                </svg>
                Google Login
            </button>

            <p id="auth-error" style="color:var(--danger); font-size:12px; margin-top:16px; display:none;">Error al
                iniciar sesi√≥n</p>
        </div>
    </div>

    <div id="app" style="display:none;">
        <!-- Top Bar -->
        <header class="top-bar">
            <div class="user-profile" onclick="switchView('view-settings')" style="cursor:pointer;">
                <img src="./assets/logo.png" alt="All4One Logo" style="height: 44px; width: auto; object-fit: contain;">
                <div class="greeting">
                    <span class="sub-text">Fitness Club</span>
                    <span class="username">Ent. Miguel</span>
                </div>
            </div>
            <div class="actions">
                <button class="icon-btn" id="global-top-action" aria-label="A√±adir Nuevo"
                    onclick="handleGlobalAction()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Dashboard View (Overview) -->
            <section id="view-dashboard" class="view active">
                <div class="section-header">
                    <h2>Panel de Coach</h2>
                    <button class="icon-btn" onclick="logout()" title="Cerrar Sesi√≥n" style="color:var(--danger);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                    </button>
                </div>

                <!-- Business Stats -->
                <div class="stats-row mb-4">
                    <div class="stat-box highlight">
                        <span class="num" id="stat-active-students">--</span>
                        <span class="lbl">Alumnos Activos</span>
                    </div>
                    <div class="stat-box" onclick="switchView('view-checkins')" style="cursor:pointer;">
                        <span class="num" id="stat-reviews">--</span>
                        <span class="lbl">Check-ins Pendientes</span>
                    </div>
                    <div class="stat-box"
                        onclick="$('#accounting-modal').classList.add('open'); window.renderAccountingTable && renderAccountingTable()"
                        style="cursor:pointer;">
                        <span class="num" id="stat-income">--</span>
                        <span class="lbl">Ingresos Mes</span>
                    </div>
                </div>

                <div class="stats-row mb-4">
                    <div class="stat-box">
                        <span class="num" id="stat-sessions">--</span>
                        <span class="lbl">Sesiones Semana</span>
                    </div>
                </div>

                <div class="section-header">
                    <h2>Agenda de Hoy</h2>
                    <a href="#" class="text-link" onclick="switchView('view-calendar')">Ver Calendario</a>
                </div>
                <div class="card schedule-card">
                    <div id="agenda-list">
                        <div class="schedule-item">
                            <div class="time">09:00</div>
                            <div class="event-info">
                                <span class="event-title">Sesi√≥n EP: Mario Garcia</span>
                                <span class="event-type">Fuerza Funcional</span>
                            </div>
                        </div>
                        <div class="schedule-item">
                            <div class="time">11:30</div>
                            <div class="event-info">
                                <span class="event-title">Revisi√≥n: Ana L.</span>
                                <span class="event-type">Bloque P√©rdida Peso</span>
                            </div>
                        </div>
                    </div>
                    <div class="agenda-actions">
                        <button class="text-link" style="background:none; border:none; cursor:pointer;"
                            onclick="openAddAgendaModal()">+ A√±adir Evento</button>
                    </div>
                </div>

                <div class="section-header">
                    <h2>Actividad Reciente</h2>
                </div>
                <div class="card activity-feed">
                    <!-- Populated by JS -->
                </div>
            </section>

            <!-- Clients View -->
            <section id="view-clients" class="view">
                <div class="search-bar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" placeholder="Buscar alumnos..." />
                </div>

                <div class="tabs-header" style="margin-bottom:16px;">
                    <!-- Status filters could go here if needed -->
                </div>

                <div class="client-list">
                    <!-- Populated by JS -->
                </div>

                <button class="floating-fab" aria-label="A√±adir Alumno">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="8.5" cy="7" r="4"></circle>
                        <line x1="20" y1="8" x2="20" y2="14"></line>
                        <line x1="23" y1="11" x2="17" y2="11"></line>
                    </svg>
                </button>
            </section>

            <!-- Client Detail View (Hidden by default) -->
            <section id="view-client-detail" class="view">
                <div class="section-header">
                    <button class="icon-btn" onclick="switchView('view-clients')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5M12 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h2>Perfil Alumno</h2>
                    <button class="icon-btn" style="color:var(--accent-color)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                </div>

                <div id="client-detail-content">
                    <!-- Populated by JS -->
                </div>
            </section>

            <!-- Library View (Split Layout) -->
            <section id="view-library" class="view">
                <div class="library-filters-container">
                    <div class="search-bar-integrated">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                        <input type="text" id="lib-search" placeholder="Busca por nombre o m√∫sculo..."
                            onkeyup="filterLibrary()">
                    </div>

                    <div class="filter-chips-wrapper" id="lib-filter-chips">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <div class="split-layout">
                    <!-- Left Pane: Exercises -->
                    <div class="library-pane">
                        <div class="library-pane-header">
                            <span>Biblioteca de Ejercicios</span>
                            <button class="text-link" style="background:none; border:none; cursor:pointer;"
                                onclick="openExerciseModal()">+ Nuevo</button>
                        </div>
                        <div class="scroll-area" id="library-source-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Right Pane: Routine Builder & List -->
                    <div class="library-pane builder-pane"
                        style="display:flex; flex-direction:column; overflow:hidden; background:transparent; border:none;">

                        <!-- Top: New Routine Builder -->
                        <div
                            style="flex:1; display:flex; flex-direction:column; min-height:0; background:rgba(245, 158, 11, 0.05); border:1px dashed var(--accent-color); border-radius:12px; margin-bottom:10px;">
                            <div class="library-pane-header"
                                style="background:transparent; border-bottom:1px dashed var(--accent-color);">
                                <span>Nueva Rutina</span>
                                <button class="btn-save-routine" onclick="saveBuiltRoutine()">Guardar</button>
                            </div>
                            <div class="scroll-area" id="routine-builder-dropzone" ondragover="allowDrop(event)"
                                ondrop="drop(event)">
                                <div class="drop-zone">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" style="margin-bottom:8px; opacity:0.5">
                                        <path d="M12 5v14M5 12h14" />
                                    </svg>
                                    <p>Arrastra ejercicios aqu√≠ o haz clic para a√±adir.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Bottom: Saved Routines List -->
                        <div
                            style="flex:1; display:flex; flex-direction:column; min-height:0; background:var(--bg-secondary); border:1px solid var(--bg-tertiary); border-radius:12px;">
                            <div class="library-pane-header">
                                <span>Mis Rutinas</span>
                                <div style="display:flex; gap:5px;">
                                    <select id="saved-routines-filter" onchange="renderSavedRoutines()"
                                        style="background:var(--bg-primary); color:white; border:none; border-radius:4px; padding:2px 6px; font-size:11px;">
                                        <option value="all">Todas</option>
                                        <option value="fuerza">Fuerza</option>
                                        <option value="hipertrofia">Hipertrofia</option>
                                    </select>
                                </div>
                            </div>
                            <div class="scroll-area" id="saved-routines-list">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            <!-- Detail View -->
            <section id="view-client-detail" class="view">
                <button class="btn-back-floating" onclick="switchView('view-clients')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                    <span>Volver</span>
                </button>
                <div class="detail-spacer" style="height:20px;"></div>
                <div id="client-detail-content"></div>
            </section>

            <!-- Settings View -->
            <section id="view-settings" class="view">
                <div class="profile-header">
                    <div class="profile-avatar-large">M</div>
                    <h2>Ent. Miguel</h2>
                    <p>Coach Deportivo</p>
                </div>
                <div class="settings-list">
                    <div class="setting-item" onclick="openAccountingModal()" style="cursor:pointer;">
                        <span>Contabilidad</span>
                        <svg style="color:var(--text-secondary)" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </div>
                </div>
            </section>

            <!-- Calendar View (Sub-app) -->
            <section id="view-calendar" class="view">
                <div class="section-header">
                    <button class="icon-btn" onclick="switchView('view-dashboard')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5M12 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h2>Calendario Semanal</h2>
                    <div style="display:flex; gap:8px;">
                        <button class="icon-btn text-link" onclick="openAddAgendaModal()">+ Nuevo Evento</button>
                    </div>
                </div>

                <div class="calendar-container">
                    <div id="calendar-grid" class="calendar-grid">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>

            <!-- Check-ins View -->
            <section id="view-checkins" class="view">
                <div class="section-header">
                    <button class="icon-btn" onclick="switchView('view-dashboard')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5M12 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <h2>Revisiones Semanales</h2>
                    <button class="icon-btn" onclick="renderCheckins()">üîÑ</button>
                </div>

                <div class="tabs-header" style="margin-bottom:16px;">
                    <button class="tab-btn active" id="tab-checkins-pending"
                        onclick="filterCheckins('pending')">Pendientes</button>
                    <button class="tab-btn" id="tab-checkins-completed"
                        onclick="filterCheckins('completed')">Completados</button>
                </div>

                <div class="checkin-list" id="checkin-list-container" style="display:grid; gap:12px;">
                    <!-- Populated by JS -->
                </div>
            </section>

            <!-- Check-in Review Modal -->
            <div class="modal-overlay" id="review-modal">
                <div class="modal modal-lg">
                    <div class="section-header">
                        <h2 id="review-modal-title">Revisi√≥n de Alumno</h2>
                        <button class="icon-btn" onclick="closeModal('review-modal')">‚úï</button>
                    </div>
                    <div class="modal-body" id="review-modal-content">
                        <!-- Populated by JS -->
                    </div>
                    <div class="modal-actions">
                        <textarea id="review-feedback" placeholder="Escribe tu feedback aqu√≠..." rows="3"
                            style="width:100%; margin-bottom:10px; padding:10px; border-radius:8px; border:1px solid var(--bg-tertiary); background:var(--bg-primary); color:white;"></textarea>
                        <button class="btn-primary" onclick="submitReviewFeedback()">Enviar Feedback y Cerrar</button>
                    </div>
                </div>
            </div>

        </main>

        <!-- STUDENT: Home View (Inicio) -->
        <section id="view-student-home" class="view">
            <div class="search-bar" style="margin-bottom: 20px; border: 1px solid #333; background: #000;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input type="text" placeholder="Buscar..." style="color: white;" />
                <div style="margin-left: auto; display: flex; gap: 15px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                </div>
            </div>

            <div class="home-header" style="text-align: center; margin-bottom: 25px;">
                <div class="logo-circle"
                    style="width: 80px; height: 80px; background: black; border-radius: 50%; margin: 0 auto 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid #333;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M6.5 6.5h11a1.5 1.5 0 0 1 1.5 1.5v11a1.5 1.5 0 0 1-1.5 1.5h-11a1.5 1.5 0 0 1-1.5-1.5v-11a1.5 1.5 0 0 1 1.5-1.5z">
                        </path>
                        <path d="M6 10l5 5 7-7"></path>
                    </svg>
                </div>
                <h2 style="font-size: 20px; color: white; margin: 0;">Fitness Club</h2>
            </div>

            <div class="quick-actions-grid"
                style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 30px; text-align: center;">
                <div class="action-item">
                    <div class="icon-box" style="margin-bottom: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                            stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <span style="font-size: 12px; color: #888;">Agenda</span>
                </div>
                <div class="action-item">
                    <div class="icon-box" style="margin-bottom: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                            stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <span style="font-size: 12px; color: #888;">Reservas</span>
                </div>
                <div class="action-item">
                    <div class="icon-box" style="margin-bottom: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                            stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                            <path d="M8 14h.01"></path>
                            <path d="M12 14h.01"></path>
                            <path d="M16 14h.01"></path>
                            <path d="M8 18h.01"></path>
                            <path d="M12 18h.01"></path>
                            <path d="M16 18h.01"></path>
                        </svg>
                    </div>
                    <span style="font-size: 12px; color: #888;">Horario</span>
                </div>
                <div class="action-item">
                    <div class="icon-box" style="margin-bottom: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                            stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="9" cy="21" r="1"></circle>
                            <circle cx="20" cy="21" r="1"></circle>
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                        </svg>
                    </div>
                    <span style="font-size: 12px; color: #888;">Tienda</span>
                </div>
            </div>

            <div class="social-banner"
                style="background: white; border-radius: 8px; padding: 15px; margin-bottom: 25px; color: black; position: relative;">
                <div style="font-weight: 500; margin-bottom: 10px;">¬°Descubre nuestras redes sociales!</div>
                <div style="display: flex; gap: 15px;">
                    <div
                        style="width: 40px; height: 40px; background: #25D366; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white"
                            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                            </path>
                        </svg>
                    </div>
                    <div
                        style="width: 40px; height: 40px; background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                        </svg>
                    </div>
                </div>
                <button
                    style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 18px; color: #999;">√ó</button>
            </div>

            <div class="store-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="font-size: 14px; font-weight: 700; color: #888; letter-spacing: 1px;">TIENDA ONLINE
                    </h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#5BC0DE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </div>

                <div style="display: flex; gap: 15px; overflow-x: auto; padding-bottom: 20px;">
                    <!-- Product 1 -->
                    <div style="min-width: 160px; background: white; border-radius: 4px; padding: 10px; color: black;">
                        <div
                            style="height: 140px; background: #eee; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; position: relative;">
                            <img src="./assets/tshirt.png" style="max-height: 100%; max-width: 100%;" alt="Camiseta">
                            <span
                                style="position: absolute; bottom: 5px; left: 5px; background: #007bff; color: white; font-size: 10px; padding: 2px 5px; font-weight: 700;">REBAJAS</span>
                            <span
                                style="position: absolute; bottom: 5px; right: 5px; background: #dc3545; color: white; font-size: 10px; padding: 2px 5px; font-weight: 700;">-27%</span>
                        </div>
                        <div style="font-size: 12px; color: #dc3545; font-weight: 600; margin-bottom: 2px;">¬°Ahorra
                            5.39‚Ç¨!</div>
                        <div style="margin-bottom: 5px;">
                            <span style="font-size: 16px; font-weight: 800;">14.56 ‚Ç¨</span>
                            <span style="font-size: 12px; color: #999; text-decoration: line-through;">19.95‚Ç¨</span>
                        </div>
                        <div style="font-size: 11px; font-weight: 600; line-height: 1.3;">CAMISETA CHICA NUEVA
                            COLECCI√ìN BENALM√ÅDENA</div>
                    </div>

                    <!-- Product 2 -->
                    <div style="min-width: 160px; background: white; border-radius: 4px; padding: 10px; color: black;">
                        <div
                            style="height: 140px; background: #eee; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; position: relative;">
                            <img src="./assets/wristband.png" style="max-height: 100%; max-width: 100%;"
                                alt="Mu√±equera">
                            <span
                                style="position: absolute; bottom: 5px; left: 5px; background: #007bff; color: white; font-size: 10px; padding: 2px 5px; font-weight: 700;">REBAJAS</span>
                            <span
                                style="position: absolute; bottom: 5px; right: 5px; background: #dc3545; color: white; font-size: 10px; padding: 2px 5px; font-weight: 700;">-27%</span>
                        </div>
                        <div style="font-size: 12px; color: #dc3545; font-weight: 600; margin-bottom: 2px;">¬°Ahorra
                            4.02‚Ç¨!</div>
                        <div style="margin-bottom: 5px;">
                            <span style="font-size: 16px; font-weight: 800;">10.88 ‚Ç¨</span>
                            <span style="font-size: 12px; color: #999; text-decoration: line-through;">14.90‚Ç¨</span>
                        </div>
                        <div style="font-size: 11px; font-weight: 600; line-height: 1.3;">MU√ëEQUERA VELCRO</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- STUDENT: Menu View (La Roca Style) -->
        <section id="view-student-menu" class="view" style="padding: 0;">
            <div class="menu-header"
                style="background: black; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333;">
                <div style="flex: 1;"></div> <!-- Spacer -->
                <h2 style="color: white; font-size: 18px; margin: 0; font-weight: 600;">Men√∫</h2>
                <div style="flex: 1; display: flex; justify-content: flex-end; gap: 15px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                </div>
            </div>

            <div class="menu-list" style="background: white;">
                <!-- Mensajes -->
                <div class="menu-item" onclick="alert('Funcionalidad de Mensajes pr√≥ximamente')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer;">
                    <div style="margin-right: 15px; color: #5BC0DE;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z">
                            </path>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Mensajes</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- Ranking -->
                <div class="menu-item" onclick="alert('Ranking pr√≥ximamente')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer;">
                    <div style="margin-right: 15px; color: #F0AD4E;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                            <path d="M4 22h16"></path>
                            <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Ranking</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- Timer -->
                <div class="menu-item" onclick="alert('Timer pr√≥ximamente')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer; margin-bottom: 20px;">
                    <div style="margin-right: 15px; color: #5BC0DE;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Timer</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- SECTION: EVOLUCI√ìN Y √öLTIMAS MARCAS -->
                <div
                    style="padding: 10px 20px; background: #f5f5f5; color: #999; font-size: 11px; font-weight: 700; text-transform: uppercase;">
                    Evoluci√≥n y √öltimas Marcas</div>

                <!-- Calendario -->
                <div class="menu-item" onclick="switchView('view-calendar')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer;">
                    <div style="margin-right: 15px; color: #D9534F;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Calendario</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- Mis m√°ximas -->
                <div class="menu-item" onclick="alert('Mis m√°ximas pr√≥ximamente')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer;">
                    <div style="margin-right: 15px; color: #F0AD4E;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="8" r="7"></circle>
                            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Mis m√°ximas</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- Evoluci√≥n f√≠sica -->
                <div class="menu-item" onclick="alert('Evoluci√≥n f√≠sica pr√≥ximamente')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer; margin-bottom: 20px;">
                    <div style="margin-right: 15px; color: #0275D8;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
                            <line x1="16" y1="8" x2="2" y2="22"></line>
                            <line x1="17.5" y1="15" x2="9" y2="15"></line>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Evoluci√≥n f√≠sica</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- SECTION: T√âCNICA -->
                <div
                    style="padding: 10px 20px; background: #f5f5f5; color: #999; font-size: 11px; font-weight: 700; text-transform: uppercase;">
                    T√©cnica</div>

                <!-- Librer√≠a de ejercicios -->
                <div class="menu-item" onclick="switchView('view-library')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer;">
                    <div style="margin-right: 15px; color: #5E35B1;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Librer√≠a de
                        ejercicios</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- Mis v√≠deos -->
                <div class="menu-item" onclick="alert('Mis v√≠deos pr√≥ximamente')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer; margin-bottom: 20px;">
                    <div style="margin-right: 15px; color: #D32F2F;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="23 7 16 12 23 17 23 7"></polygon>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Mis v√≠deos</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <!-- SECTION: PREFERENCIAS -->
                <div
                    style="padding: 10px 20px; background: #f5f5f5; color: #999; font-size: 11px; font-weight: 700; text-transform: uppercase;">
                    Preferencias y Privacidad</div>

                <!-- Ajustes -->
                <div class="menu-item" onclick="switchView('view-settings')"
                    style="padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; cursor: pointer; margin-bottom: 20px;">
                    <div style="margin-right: 15px; color: #333;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                            </path>
                        </svg>
                    </div>
                    <span style="font-size: 16px; color: #333; font-weight: 500; flex: 1;">Ajustes</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </div>

                <div style="padding: 20px; text-align: center; color: #ccc;">
                    <div style="font-size: 12px; font-weight: 700; margin-bottom: 5px;">POWERED BY</div>
                    <div style="font-size: 16px; font-weight: 800; font-style: italic;">TIMP</div>
                </div>
            </div>
        </section>

        </main>

        <!-- Bottom Navigation (Shared) -->
        <nav class="bottom-nav">
            <!-- Student Navigation -->
            <a href="#" class="nav-item student-nav active" data-target="view-student-home">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                Inicio
            </a>
            <a href="#" class="nav-item student-nav" data-target="view-dashboard">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
                Entreno
            </a>
            <a href="#" class="nav-item student-nav" data-target="view-client-detail">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Perfil
            </a>
            <a href="#" class="nav-item student-nav" data-target="view-student-menu">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
                Men√∫
            </a>

            <!-- Admin Navigation (Hidden for students in JS) -->
            <a href="#" class="nav-item admin-nav" data-target="view-dashboard">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Inicio
            </a>
            <a href="#" class="nav-item admin-nav" data-target="view-clients">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                Alumnos
            </a>
            <a href="#" class="nav-item admin-nav" data-target="view-calendar">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                Calendario
            </a>
            <a href="#" class="nav-item admin-nav" data-target="view-library">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
                Biblioteca
            </a>
            <a href="#" class="nav-item admin-nav" data-target="view-settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
                Admin
            </a>
        </nav>

        <!-- Client Modal -->
        <div class="modal-overlay" id="client-modal">
            <div class="modal">
                <h2 id="modal-title">Nuevo Alumno</h2>
                <form id="client-form">
                    <input type="hidden" id="client-id" />

                    <div class="form-group">
                        <label>Nombre Completo</label>
                        <input type="text" id="client-name" required placeholder="Ej. Juan P√©rez" />
                    </div>

                    <div class="form-group">
                        <label>Email (Google)</label>
                        <input type="email" id="client-email-basic" placeholder="ejemplo@gmail.com" />
                    </div>

                    <div class="form-group">
                        <label>Plan de Entrenamiento</label>
                        <select id="client-plan" required>
                            <option value="">Selecciona un plan...</option>
                            <!-- Populated by JS from state.trainingPlans -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Objetivo Principal</label>
                        <select id="client-goal">
                            <option value="">Selecciona objetivo...</option>
                            <!-- Populated by JS from state.availableGoals -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Estado</label>
                        <select id="client-status">
                            <option value="active">Activo</option>
                            <option value="pending">Pendiente</option>
                            <option value="inactive">Inactivo (Baja)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Cuota Mensual (‚Ç¨)</label>
                        <input type="number" id="client-fee" required placeholder="Ej. 50" />
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-ghost cancel-btn">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Create Routine Modal -->
        <div class="modal-overlay" id="routine-modal">
            <!-- ... existing content if any, or leave empty if builder takes over ... -->
        </div>

        <!-- Assign Routine Modal -->
        <div class="modal-overlay" id="assign-modal">
            <div class="modal modal-lg">
                <h2>Programar Entrenamiento</h2>
                <p class="mb-4" id="assign-target-name" style="color:var(--text-secondary); font-size:14px;">Asignando
                    a...</p>
                <form id="assign-form">
                    <input type="hidden" id="assign-client-id" />

                    <div class="form-section">
                        <h4>Selecci√≥n de Rutina</h4>
                        <div class="form-group full-width">
                            <label>Rutina</label>
                            <select id="assign-routine-select">
                                <!-- populated by JS -->
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h4>Programaci√≥n y Horario</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Fecha</label>
                                <input type="date" id="assign-date" required>
                            </div>
                            <div class="form-group">
                                <label>Hora</label>
                                <input type="time" id="assign-time" required value="10:00">
                            </div>
                            <div class="form-group full-width">
                                <label>Nota Adicional</label>
                                <input type="text" id="assign-notes" placeholder="Ej. Foco en t√©cnica de sentadilla">
                            </div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-ghost" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn-primary">Confirmar y A√±adir al Calendario</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Detailed New Student Modal -->
        <div class="modal-overlay" id="new-student-modal">
            <div class="modal modal-lg">
                <div class="section-header">
                    <h2>Nuevo Alumno</h2>
                    <button class="icon-btn" onclick="closeModal('new-student-modal')">‚úï</button>
                </div>
                <form id="new-student-form" class="modal-body-scroll">

                    <!-- Personal Data -->
                    <div class="form-section">
                        <h4>Datos Personales</h4>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label>Nombre Completo</label>
                                <input type="text" name="name" required placeholder="Ej. Juan P√©rez">
                            </div>
                            <div class="form-group">
                                <label>Fecha Nac.</label>
                                <input type="date" name="dob">
                            </div>
                            <div class="form-group">
                                <label>G√©nero</label>
                                <select name="gender">
                                    <option value="male">Masculino</option>
                                    <option value="female">Femenino</option>
                                    <option value="other">Otro</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Contact -->
                    <div class="form-section">
                        <h4>Contacto</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="email" placeholder="juan@email.com">
                            </div>
                            <div class="form-group">
                                <label>Tel√©fono</label>
                                <input type="tel" name="phone" placeholder="+34 600...">
                            </div>
                        </div>
                    </div>

                    <!-- Physical Data & Goals -->
                    <div class="form-section">
                        <h4>Ficha T√©cnica</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Altura (cm)</label>
                                <input type="number" name="height" placeholder="175">
                            </div>
                            <div class="form-group">
                                <label>Peso (kg)</label>
                                <input type="number" name="weight" placeholder="70">
                            </div>
                            <div class="form-group full-width">
                                <label>Objetivo Principal</label>
                                <select name="goal" id="new-student-goal">
                                    <option value="">Selecciona...</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Fecha Objetivo</label>
                                <input type="date" name="targetDate">
                            </div>
                            <div class="form-group full-width">
                                <label>Lesiones / Notas</label>
                                <input type="text" name="notes" placeholder="Ej. Dolor de rodilla izquierda...">
                            </div>
                            <div class="form-group full-width">
                                <label>Plan Inicial</label>
                                <select name="plan" id="new-student-plan">
                                    <option value="">Selecciona...</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Cuota Mensual (‚Ç¨)</label>
                                <input type="number" name="monthlyFee" placeholder="50" required>
                            </div>
                            <div class="form-group">
                                <label>Estado Inicial</label>
                                <select name="status">
                                    <option value="active">Activo</option>
                                    <option value="pending">Pendiente</option>
                                    <option value="inactive">Inactivo</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-ghost"
                            onclick="closeModal('new-student-modal')">Cancelar</button>
                        <button type="submit" class="btn-primary">Registrar Alumno</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Video Modal -->
        <div class="modal-overlay" id="video-modal">
            <div class="modal modal-lg">
                <div class="section-header">
                    <h2 id="video-modal-title">Video de Ejercicio</h2>
                    <button class="icon-btn" onclick="closeModal('video-modal')">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="video-container"
                        style="border-radius: 12px; overflow: hidden; background: #000; aspect-ratio: 16/9; margin-bottom: 20px;">
                        <iframe id="exercise-video-player" width="100%" height="100%" src="" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen></iframe>
                    </div>
                    <div class="exercise-details-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div>
                            <h3 style="margin-bottom:10px; color:var(--accent-color); font-size:16px;">T√©cnica Paso a
                                Paso</h3>
                            <p id="video-exercise-description"
                                style="color:var(--text-secondary); line-height:1.6; font-size:13px;"></p>
                        </div>
                        <div
                            style="background: rgba(239, 68, 68, 0.05); border: 1px solid rgba(239, 68, 68, 0.2); border-radius:12px; padding:15px;">
                            <h3
                                style="margin-bottom:10px; color:var(--danger); display:flex; align-items:center; gap:8px; font-size:16px;">
                                ‚ö†Ô∏è Zonas a Proteger
                            </h3>
                            <p id="video-exercise-safety"
                                style="color:var(--text-primary); font-size:13px; line-height:1.5;"></p>
                            <div id="exercise-diagram-container"
                                style="margin-top:15px; border-radius:8px; overflow:hidden; border:1px solid var(--bg-tertiary); background:var(--bg-primary); padding:10px; text-align:center;">
                                <!-- Icon/Small Illustration based on muscle group -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Agenda Event Modal -->
        <div class="modal-overlay" id="agenda-modal">
            <div class="modal">
                <h2>A√±adir a la Agenda</h2>
                <form id="agenda-form">
                    <div class="form-group">
                        <label>Hora</label>
                        <input type="time" id="agenda-time" required value="09:00">
                    </div>
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="agenda-date" required>
                    </div>
                    <div class="form-group">
                        <label>Evento</label>
                        <input type="text" id="agenda-title" required placeholder="Ej. Sesi√≥n Juan">
                    </div>
                    <div class="form-group">
                        <label>Tipo</label>
                        <select id="agenda-type">
                            <option value="Sesi√≥n EP">Sesi√≥n EP</option>
                            <option value="Revisi√≥n">Revisi√≥n</option>
                            <option value="Consulta">Consulta</option>
                        </select>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-ghost" onclick="closeModal('agenda-modal')">Cancelar</button>
                        <button type="submit" class="btn-primary">A√±adir</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Exercise Manual Add/Edit Modal -->
        <div class="modal-overlay" id="exercise-modal">
            <div class="modal">
                <h2 id="ex-modal-title">Nuevo Ejercicio</h2>
                <form id="exercise-form">
                    <input type="hidden" id="ex-edit-id">
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" id="ex-name" required placeholder="Ej. Squat con Salto">
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a/M√∫sculo</label>
                        <select id="ex-muscle">
                            <option value="Piernas">Piernas</option>
                            <option value="Espalda">Espalda</option>
                            <option value="Pecho">Pecho</option>
                            <option value="Brazos">Brazos</option>
                            <option value="Torso">Torso</option>
                            <option value="Cardio">Cardio</option>
                            <option value="Deka">Deka</option>
                            <option value="Calentamiento">Calentamiento</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>V√≠deo URL (YouTube)</label>
                        <input type="url" id="ex-video" placeholder="https://youtube.com/...">
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n (5 puntos clave)</label>
                        <textarea id="ex-description" rows="5"
                            style="width:100%; background:var(--bg-primary); border:1px solid var(--bg-tertiary); color:white; border-radius:8px; padding:12px; font-family:inherit;"
                            placeholder="- Punto 1&#10;- Punto 2..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn-ghost" onclick="closeModal('exercise-modal')">Cancelar</button>
                        <button type="submit" class="btn-primary">Guardar Ejercicio</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Full Screen Global Menu -->
        <div id="fullscreen-menu" class="fullscreen-menu">
            <button class="close-menu-btn" onclick="closeFullscreenMenu()">‚úï</button>
            <div class="menu-content">
                <h2 style="color:white; text-align:center; margin-bottom:40px; font-size:28px;">¬øQu√© quieres hacer?</h2>
                <div class="menu-grid">
                    <div class="menu-card" onclick="menuAction('new-student')">
                        <div class="menu-icon">üë§</div>
                        <h3>Nuevo Alumno</h3>
                        <p>Registrar un nuevo socio en el club</p>
                    </div>
                    <div class="menu-card" onclick="menuAction('new-routine')">
                        <div class="menu-icon">üìù</div>
                        <h3>Nueva Rutina</h3>
                        <p>Crear un plan de entrenamiento</p>
                    </div>
                    <div class="menu-card" onclick="menuAction('new-activity')">
                        <div class="menu-icon">üìÖ</div>
                        <h3>Nueva Actividad</h3>
                        <p>Agendar evento o sesi√≥n</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Database View -->
        <section id="view-database" class="view">
            <div class="section-header">
                <button class="icon-btn" onclick="switchView('view-settings')">‚Üê Volver</button>
                <h2>Base de Datos</h2>
                <div></div>
            </div>

            <div class="db-tabs">
                <button class="db-tab active" onclick="switchDbTab('clients')">Alumnos</button>
                <button class="db-tab" onclick="switchDbTab('sessions')">Sesiones</button>
                <button class="db-tab" onclick="switchDbTab('routines')">Rutinas</button>
            </div>

            <div class="db-table-container">
                <div class="db-filters">
                    <input type="text" id="db-search" placeholder="Buscar..." onkeyup="renderDbTable()">
                    <select id="db-sort" onchange="renderDbTable()">
                        <option value="newest">M√°s recientes</option>
                        <option value="oldest">M√°s antiguos</option>
                        <option value="name">Nombre</option>
                    </select>
                </div>
                <div class="table-responsive">
                    <table id="db-table">
                        <!-- Populated by JS -->
                    </table>
                </div>
            </div>
        </section>

        <!-- Accounting Modal -->
        <div class="modal-overlay" id="accounting-modal">
            <div class="modal modal-lg" style="max-height:85vh; overflow-y:auto;">
                <div class="section-header">
                    <h2>Contabilidad</h2>
                    <button class="icon-btn" onclick="closeModal('accounting-modal')">‚úï</button>
                </div>

                <div class="card"
                    style="margin-bottom:20px; background:var(--bg-secondary); border:1px solid var(--bg-tertiary);">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="color:var(--text-secondary); font-size:13px;">Ingresos Totales (Historico)</span>
                        <span style="font-size:24px; font-weight:700; color:var(--success);"
                            id="acc-total-revenue">‚Ç¨0</span>
                    </div>
                </div>

                <div class="db-filters" style="margin-bottom:15px;">
                    <input type="text" id="acc-search" placeholder="Buscar alumno..." onkeyup="renderAccountingTable()">
                </div>

                <div class="table-responsive">
                    <table id="acc-table" style="width:100%; border-collapse:collapse; font-size:13px;">
                        <thead>
                            <tr>
                                <th style="text-align:left; padding:10px; color:var(--text-secondary);">Alumno</th>
                                <th style="text-align:right; padding:10px; color:var(--text-secondary);">Cuota</th>
                                <th style="text-align:right; padding:10px; color:var(--text-secondary);">Meses Activo
                                </th>
                                <th style="text-align:right; padding:10px; color:var(--text-secondary);">Total Pagado
                                </th>
                            </tr>
                        </thead>
                        <tbody id="acc-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Navigation Bar (Mobile) -->
        <nav class="bottom-nav">
            <!-- Student Nav -->
            <a href="#" class="nav-item nav-student" data-target="view-student-home"
                onclick="if(state.userRole==='student') switchView('view-student-home');">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>Inicio</span>
            </a>
            <a href="#" class="nav-item nav-student" data-target="view-library"
                onclick="if(state.userRole==='student') { switchView('view-library'); setLibMode('routines'); }">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                    <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                    <line x1="6" y1="1" x2="6" y2="4"></line>
                    <line x1="10" y1="1" x2="10" y2="4"></line>
                    <line x1="14" y1="1" x2="14" y2="4"></line>
                </svg>
                <span>Entrenos</span>
            </a>
            <a href="#" class="nav-item nav-student" data-target="view-client-detail"
                onclick="if(state.userRole==='student') openClientDetail(state.currentStudentId);">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span>Perfil</span>
            </a>
            <a href="#" class="nav-item nav-student" data-target="view-student-menu"
                onclick="if(state.userRole==='student') switchView('view-student-menu');">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
                <span>Men√∫</span>
            </a>

            <!-- Admin Nav -->
            <a href="#" class="nav-item nav-admin active" data-target="view-dashboard"
                onclick="switchView('view-dashboard')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                <span>Inicio</span>
            </a>
            <a href="#" class="nav-item nav-admin" data-target="view-clients" onclick="switchView('view-clients')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                </svg>
                <span>Alumnos</span>
            </a>

            <div class="nav-fab-container nav-admin">
                <button class="nav-fab" onclick="document.querySelector('.fab-menu').classList.toggle('active')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
                <div class="fab-menu">
                    <button onclick="openCreateStudentModal()">
                        <span>Nuevo Alumno</span>
                    </button>
                    <button onclick="switchView('view-library'); setLibMode('routines');">
                        <span>Nueva Rutina</span>
                    </button>
                    <button onclick="openAddAgendaModal()">
                        <span>Agendar</span>
                    </button>
                    <button onclick="$('#accounting-modal').classList.add('open'); renderAccountingTable();">
                        <span>Contabilidad</span>
                    </button>
                </div>
            </div>

            <a href="#" class="nav-item nav-admin" data-target="view-calendar" onclick="switchView('view-calendar')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>Agenda</span>
            </a>
            <a href="#" class="nav-item nav-admin" data-target="view-library" onclick="switchView('view-library')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                </svg>
                <span>Biblioteca</span>
            </a>
        </nav>
    </div>
    <script src="./js/library_db.js"></script>
    <script src="./js/calendar.js"></script>
    <script src="./js/app.js" defer></script>

    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('SW registered:', registration))
                    .catch(err => console.log('SW registration failed:', err));
            });
        }

        // Initialize SortableJS for drag & drop functionality
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for library to render
            setTimeout(() => {
                initSortables();
            }, 500);
        });

        function initSortables() {
            const libraryList = document.getElementById('library-source-list');
            const builderDropzone = document.getElementById('routine-builder-dropzone');

            if (libraryList && window.Sortable) {
                // Library source - clone on drag
                new Sortable(libraryList, {
                    group: {
                        name: 'exercises',
                        pull: 'clone',
                        put: false
                    },
                    animation: 150,
                    sort: false,
                    onEnd: function (evt) {
                        console.log('Dragged from library');
                    }
                });
            }

            if (builderDropzone && window.Sortable) {
                // Builder dropzone - accept exercises
                new Sortable(builderDropzone, {
                    group: {
                        name: 'exercises',
                        pull: true,
                        put: true
                    },
                    animation: 150,
                    onAdd: function (evt) {
                        const exerciseId = evt.item.dataset.id;
                        if (exerciseId && window.addExerciseToBuilder) {
                            window.addExerciseToBuilder(parseInt(exerciseId));
                        }
                    },
                    onUpdate: function (evt) {
                        console.log('Reordered in builder');
                    }
                });
            }
        }

        // Re-initialize when switching to library view
        const originalSwitchView = window.switchView;
        if (originalSwitchView) {
            window.switchView = function (viewId) {
                originalSwitchView(viewId);
                if (viewId === 'view-library') {
                    setTimeout(() => initSortables(), 300);
                }
            };
        }
    </script>
    <script src="./js/plans-goals-manager.js" defer></script>
</body>

</html>